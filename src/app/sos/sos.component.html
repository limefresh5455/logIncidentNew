<h5 *ngIf="sosView" class="bevelTitle">SOS({{sosTitle}})</h5>
<div class="col-12">
  <div class="row">
    <div class="col-sm-4">
      <div id="sosrange" class="btn-info sos-custom-range">
        <i class="fa fa-calendar"></i>&nbsp;
        <span></span> <i class="fa fa-caret-down faCarets"></i>
      </div>
    </div>
  </div>
</div>
<div class="col-12">
  <hr/>
  <ul class="nav nav-tabs" role="tablist">
    <li class="nav-item">
      <a class="nav-link active" data-toggle="tab" href="#"
         data-target="#m_tabs_1_1">{{sosTitle}}</a>
    </li>
  </ul>
  <div class="tab-content">
    <div class="tab-pane active" id="m_tabs_1_1" role="tabpanel">
      <div class="row">
        <div class="col-xl-12">
          <div class="m-portlet m-portlet--head-solid-bg m-portlet--success m-portlet--rounded">
            <div class="m-portlet__body">
              <div class="col-12 row pb-2">
                <div class="mr-auto">
                  <button class="btn btn-primary" (click)="toggle()" id="bt">
                    {{buttonName}}
                  </button>
                </div>
                <div class="ml-auto">
                  <button class="btn btn-primary" id="bt" (click)="openFilterModal(filterModal)">
                    Filter
                  </button>
                </div>
              </div>
              <div class="m-section" *ngIf="show">
                <div class="m-section__content" style="overflow: scroll">
                  <table class="table table-hover table-responsive-sm" [ngStyle]="{'max-width': '100%'}">
                    <thead [style.background-color]="sosColor" [style.border-color]="sosColor" [ngStyle]="{'color': '#fff'}">
                    <tr>
                      <th>ID</th>
                      <th scope="col" sortable="name" (sort)="onSort($event)">Name</th>
                      <th scope="col" sortable="attendee" (sort)="onSort($event)">Attendees</th>
                      <th scope="col" sortable="createdAt" (sort)="onSort($event)">Created</th>
                      <th scope="col" sortable="overall" (sort)="onSort($event)">Overall</th>
                      <th scope="col" sortable="bodyposition" (sort)="onSort($event)">Body Position</th>
                      <th scope="col" sortable="procedures" (sort)="onSort($event)">Procedures</th>
                      <th scope="col" sortable="ppe" (sort)="onSort($event)">PPE</th>
                      <th scope="col" sortable="toolsequipment" (sort)="onSort($event)">Tools & Equipment</th>
                      <th scope="col" sortable="other" (sort)="onSort($event)">Other</th>
                      <th scope="col" sortable="sitespecific" (sort)="onSort($event)">Site Specific</th>
                    </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let number of [1,2,3,4,5,6,7,8]">
                        <td *ngIf="!sosDataList">
                          <div class="tableDesc loading">
                          </div>
                        </td>
                        <td *ngIf="!sosDataList">
                          <div class="tableDesc loading">
                          </div>
                        </td>
                        <td *ngIf="!sosDataList">
                          <div class="tableDesc loading">
                          </div>
                        </td>
                        <td *ngIf="!sosDataList">
                          <div class="tableDesc loading">
                          </div>
                        </td>
                        <td *ngIf="!sosDataList">
                          <div class="tableCount loading">
                          </div>
                        </td>
                        <td *ngIf="!sosDataList">
                          <div class="tableCount loading">
                          </div>
                        </td>
                        <td *ngIf="!sosDataList">
                          <div class="tableCount loading">
                          </div>
                        </td>
                        <td *ngIf="!sosDataList">
                          <div class="tableCount loading">
                          </div>
                        </td>
                        <td *ngIf="!sosDataList">
                          <div class="tableCount loading">
                          </div>
                        </td>
                        <td *ngIf="!sosDataList">
                          <div class="tableCount loading">
                          </div>
                        </td>
                        <td *ngIf="!sosDataList">
                          <div class="tableCount loading">
                          </div>
                        </td>
                      </tr>
                      <tr (click)="goToSosView(sosValue.id)" *ngFor="let sosValue of sosDataList | paginate: { itemsPerPage: 10, currentPage: p }; let i = index">
                        <th scope="row">
                          {{sosValue.id}}
                        </th>
                        <td>{{sosValue.name}}</td>
                        <td>{{sosValue.attendee}}</td>
                        <td>
                          {{sosValue.createdAt | date:'dd/MM/y'}}
                        </td>
                        <td [ngClass]="(sosValue.overall == 0) ? 'greenClass' : ((sosValue.overall >= 0) && (sosValue.overall < 11)) ? 'amberClass' : (sosValue.overall >= 12) ? 'redClass': ''">({{sosValue.overall}})</td>
                        <td [ngClass]="(sosValue.bodyposition == 0) ? 'greenClass' : ((sosValue.bodyposition >= 0) && (sosValue.bodyposition < 11)) ? 'amberClass' : (sosValue.bodyposition >= 12) ? 'redClass': ''">({{sosValue.bodyposition}})</td>
                        <td [ngClass]="(sosValue.procedures == 0) ? 'greenClass' : ((sosValue.procedures >= 0) && (sosValue.procedures < 11)) ? 'amberClass' : (sosValue.procedures >= 12) ? 'redClass': ''">({{sosValue.procedures}})</td>
                        <td [ngClass]="(sosValue.ppe == 0) ? 'greenClass' : ((sosValue.ppe >= 0) && (sosValue.ppe < 11)) ? 'amberClass' : (sosValue.ppe >= 12) ? 'redClass': ''">({{sosValue.ppe}})</td>
                        <td [ngClass]="(sosValue.toolsequipment == 0) ? 'greenClass' : ((sosValue.toolsequipment >= 0) && (sosValue.toolsequipment < 11)) ? 'amberClass' : (sosValue.toolsequipment >= 12) ? 'redClass': ''">({{sosValue.toolsequipment}})</td>
                        <td [ngClass]="(sosValue.other == 0) ? 'greenClass' : ((sosValue.other >= 0) && (sosValue.other < 11)) ? 'amberClass' : (sosValue.other >= 12) ? 'redClass': ''">({{sosValue.other}})</td>
                        <td [ngClass]="(sosValue.sitespecific == 0) ? 'greenClass' : ((sosValue.sitespecific >= 0) && (sosValue.sitespecific < 11)) ? 'amberClass' : (sosValue.sitespecific >= 12) ? 'redClass': ''">({{sosValue.sitespecific}})</td>
                      </tr>
                    </tbody>
                  </table>
                  <ng-container *ngIf="sosDataList && sosDataList.length > 0">
                    <pagination-controls style="text-align: center;" responsive="true" (pageChange)="p = $event"></pagination-controls>
                  </ng-container>
                </div>
              </div>
              <div class="m-section" *ngIf="!show">
                <div class="m-section__content" style="overflow: scroll">
                  <div class="m-portlet__head" [style.background-color]="sosColor" [style.border-color]="sosColor">
                    <div class="m-portlet__head-caption">
                      <div class="m-portlet__head-title">
                        <h3 class="m-portlet__head-text">
                          Sos Volume Graph
                        </h3>
                      </div>
                    </div>
                  </div>
                  <div class="m-portlet__body">
                    <div class="m-widget4">
                      <div class="m-widget4__chart m-portlet-fit--sides">
                        <div class="col-12 text-center">
                          <i class="fa fa-spinner fa-spin fa-3x fa-fw text-center" *ngIf="loading"></i>
                        </div>  
                        <div class="col-12 m-section__content">
                          <canvas id="sos_detail_summary_chart"></canvas>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #filterModal let-modal>
  <form [formGroup]="filterForm">
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">SOS Filter Dataset</h4>
    <button type="button" class="close" aria-label="Close" (click)="closeModal()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="col-12">
      <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
          <a class="nav-link" data-toggle="tab" href="#" data-target="#f_tabs_1_1">
            Incidents
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" data-toggle="tab" href="#"
             data-target="#f_tabs_1_2">Sos</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-toggle="tab" href="#"
             data-target="#f_tabs_1_3">Tags</a>
        </li>
      </ul>
      <div class="tab-content">
        <div class="tab-pane active" id="f_tabs_1_2" role="tabpanel">
          <div class="row">
            <div class="col-xl-12">
              <div class="m-portlet m-portlet--head-solid-bg m-portlet--success m-portlet--rounded filter-box">
                <div class="m-portlet__body">
                  <div class="col-12 row p-0 m-0">
                    <div class="col-lg-6 m-form__group form-group">
                      <mat-form-field appearance="outline">
                        <mat-label><strong>Rating</strong></mat-label>
                        <mat-select formControlName="ratings">
                          <mat-option value="All" selected>All</mat-option>
                          <mat-option value="Low">Low</mat-option>
                          <mat-option value="Medium">Medium</mat-option>
                          <mat-option value="High">High</mat-option>
                        </mat-select>
                      </mat-form-field>
                    </div>
                    <div class="col-lg-6 m-form__group form-group">
                      <mat-form-field appearance="outline">
                        <mat-label><strong>Reported By</strong></mat-label>
                        <mat-select formControlName="reported_by" multiple>
                          <mat-select-trigger>
                            {{reported_by.value ? reported_by.value[0] : ''}}
                            <span *ngIf="reported_by.value?.length > 1" class="example-additional-selection">
                              (+{{reported_by.value.length - 1}} {{reported_by.value?.length === 2 ? 'other' : 'others'}})
                            </span>
                          </mat-select-trigger>
                          <ng-container *ngFor="let option of sosReported">
                            <mat-option *ngIf="option == 'All'" [value]="option" (click)="selectAllReported(ev1)" #ev1> {{option}} </mat-option>
                            <mat-option *ngIf="option != 'All'" [value]="option" [value]="option" (click)="selectAllReported(ev1)" #ev1>{{option}}</mat-option>
                          </ng-container>                          
                        </mat-select>
                      </mat-form-field>
                    </div>
                    <div class="col-lg-6 m-form__group form-group">
                      <div id="sosrange1" class="btn-info sos-custom-range1">
                        <i class="fa fa-calendar"></i>&nbsp;
                        <span></span> <i class="fa fa-caret-down faCarets"></i>
                      </div>
                    </div>
                    <div class="col-lg-6 m-form__group form-group">
                      <mat-form-field appearance="outline">
                        <mat-label><strong>Name</strong></mat-label>
                        <mat-select formControlName="user_name" multiple>
                          <mat-select-trigger>
                            {{user_name.value ? user_name.value[0] : ''}}
                            <span *ngIf="user_name.value?.length > 1" class="example-additional-selection">
                              (+{{user_name.value.length - 1}} {{user_name.value?.length === 2 ? 'other' : 'others'}})
                            </span>
                          </mat-select-trigger>
                          <ng-container *ngFor="let option of sosUsers">
                            <mat-option *ngIf="option == 'All'" [value]="option" (click)="selectAllUsers(ev1)" #ev1> {{option}} </mat-option>
                            <mat-option *ngIf="option != 'All'" [value]="option" [value]="option" (click)="selectAllUsers(ev1)" #ev1>{{option}}</mat-option>
                          </ng-container>                          
                        </mat-select>
                      </mat-form-field>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <span class="error" *ngIf="errorShow"><strong>Data Not Found</strong></span>
    <button type="button" class="btn btn-danger" (click)="closeModal()">Close</button>
    <button type="button" class="btn btn-primary btn-graph" *ngIf="show" (click)="exportCsv()">Export Sos</button>
    <button type="button" class="btn btn-primary btn-graph" *ngIf="!show" (click)="filterGraph()">Graph</button>
    <button type="button" class="btn btn-primary btn-apply" *ngIf="show" (click)="applyFilter()">Apply</button>
  </div>
</form>
</ng-template>